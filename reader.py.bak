#!/usr/bin/python
# -*- coding: utf-8 -*-
import sys
import os
import re

def rule_single(tree):
	r1=re.findall("\(S[\n ]",tree,re.DOTALL)	
	if len(r1)==1:									#1s
		r1=re.findall("\(CC(.*)\(PP \((TO|IN) (.*?)\)",tree,re.DOTALL)
		if r1:										#1s + (CC then (PP (TO/(IN
			print "-------------------------------------"
			return [r1[0][2]]
		else:										#no dm
			return 0
	elif len(r1)>=2:								#2s
		print "lenght is 2 ",len(r1)
		r1=re.findall("\(ADVP \(RB (.*?)\)",tree,re.DOTALL)
		# print r1,len(r1)
		print "-------------------------------------"
		if len(r1)==0:								#2s + no advp ()
			r1=re.findall("SBAR",tree,re.DOTALL)	
			if len(r1)==0:							#2s + no sbar (())
				r1=re.findall("\(CC",tree,re.DOTALL)
				if len(r1)==0:						#2s + no cc   ((()))
					r1=re.findall("\(IN",tree,re.DOTALL)
					if len(r1)==0:					#2s + no in   ((((-)))) no dm
						return 0
					else:							#2s + in      (((\())))
						r1=re.findall("\(IN (.*?)\)",tree,re.DOTALL)
						return r1
				else:								#2s +cc 	  ((\()))
					r1=re.findall("\(CC (.*?)\)",tree,re.DOTALL)
					return r1		
			else:
				r1=re.findall("\(SBAR(.*)\(IN (.*?)\)",tree,re.DOTALL)
				return [r1[0][1]] 					#2s + sbar    (\())
		else:
			return r1								#2s + advp 	  \()
	else:											#no dm
		print "-------------------------------------"
		return 0

def rule_multiple(tree):
	r1=re.findall("\(S",tree,re.DOTALL)
	if len(r1)>=2:									#2s
		r1=re.findall("\(PP \(IN (.*?)\)(.*?)\)\)",tree,re.DOTALL)
		if r1:										#2s + (S (PP (IN
			r2=r1[0][1]	
			print r1[0][0]			
			r2=r2+')'
			r2=re.findall("([a-z]+)\)",r2,re.DOTALL)
			print r2		#2nd half of dm
			r1=r1[0][0]		#1st half of dm
			r1=r1+' '+' '.join(map(str,r2))
			return [r1]
		r1=re.findall("\(S[\s]+\(SBAR\s+\(IN (.*?)\)",tree,re.DOTALL)
		if r1:										#2s + (S (SBAR (IN
			return r1
		r1=re.findall("\(S[\s]+\(IN (.*?)\)",tree,re.DOTALL)
		print "++++++++++++++++++++++++++++++++++++++"
		if r1:										#2s + (S (IN
			return r1
		else:
			return 0
	else:											#no dm
		print "++++++++++++++++++++++++++++++++++++++"
		return 0

def rule1(tree):
	print tree,"\n"
	r1=re.findall("ROOT",tree,re.DOTALL)
	print r1
	if (len(r1)==1):
		return rule_single(tree)
	else:
		return rule_multiple(tree)

fi1=open((os.path.join('Section_11', 'fullnews_id_2578406_date_7_7_2004.utf8.cml.V.tkn.cml_updated.mo.pos.chnk.prun.posn')),'r')
fi=open((os.path.join('Section_11', 'test.txt')),'r')
l =fi.readlines()

index=['579..585','552..578','586..652']
data="श्रीराम जन्मभूमि मंदिर - बाबरी मस्जिद प्रकरण के सर्वमान्य समाधान के लिए ऑल इंडिया मुस्लिम पर्सनल लॉ बोर्ड से नए प्रस्तावों के तहत बातचीत की तैयारी है । कांची कामकोटि पीठ के शंकराचार्य स्वामी जयेंद्र सरस्वती ने समाधान के लिए पुनः प्रयास आरंभ कर दिया है । अयोध्या विवाद के हल के लिए अयोध्या प्रकरण समाधान समन्वय समिति का गठन किया गया है । बोर्ड से बातचीत के लिए नए प्रस्ताव पर चर्चा को अयोध्या में इसी माह के तीसरे हफ्ते बैठक होने वाली है । केंद्र में नई सरकार के गठन के साथ अयोध्या विवाद के समाधान के लिए भी नए सिरे से प्रयास शुरू हो गए हैं । इस बार इसकी कमान कांची कामिकोटि के शंकराचार्य स्वामी जयेंद्र सरस्वती के हाथ है । शंकराचार्य ने जून के पहले सप्ताह के अपने दिल्ली प्रवास के दौरान मुस्लिम राष्ट्रों के राजदूतों , यूपीए अध्यक्ष सोनिया गांधी , एनडीए अध्यक्ष अटल बिहारी वाजपेयी , प्रधानमंत्री , लोकसभा में नेता प्रतिपक्ष , वरिष्ठ केंद्रीय मंत्रीगण , पूर्व प्रधानमंत्री पी. वी. नरसिंहाराव , उच्चतम न्यायालय के पूर्व न्यायाधीश रंगनाथ मिश्र , पूर्व मुख्य चुनाव आयुक्त जीबीजी कृष्णामूर्ति , विहिप के कार्यकारी अध्यक्ष अशोक सिंघल सहित कई लोगों से प्रकरण के समाधान पर बातचीत की है । शंकराचार्य की जिन लोगों से आमने - सामने बात नहीं हो पाई उनसे दूरभाष पर संपर्क करके अयोध्या प्रकरण के समाधान पर सक्रिय योगदान देने के लिए भी कहा है । इनमें बाबरी मस्जिद एक्शन कमेटी के संयोजक जफरयाब जिलानी , श्रीराम जन्मभूमि न्यास के अध्यक्ष महंत नृत्य गोपाल दास , निर्मोही अखाड़े के भाष्करदास , उनके अधिवक्ता रणजीतलाल वर्मा , गोरक्ष पीठाधीश्वर महंत अवैद्यनाथ आदि हैं । विवाद के समाधान के लिए लगातार बातचीत का दौर और संपर्क जारी रखने के लिए अयोध्या प्रकरण समाधान समन्वय समिति का गठन किया गया है । यह समिति शंकराचार्य के निर्देश में कार्यो का निष्पादन करेगी । इसमें सदस्य के तौर पर अयोध्या से विमलेंद्र मोहन प्रताप मिश्र , फैजाबाद से खालिक अहमद खान , चेन्नई से शंकराचार्य के प्रमुख सचिव सुंदर , अहमदाबाद से कृष्ण कुमार सिंघल व नई दिल्ली से अयोध्या जामा मस्जिद ट्रस्ट के अध्यक्ष व प्रबंध न्यासी अल्लामा सैयद असगर अब्बास रिजवी नामित किए गए हैं । रिजवी समिति के संयोजक बनाए गए हैं । रिजवी ने भी समिति के गठन की पुष्टि की है । श्री रिजवी ने बताया कि समिति ने अब तक अयोध्या प्रकरण के समाधान के लिए विचार मंथन चक्र चलाया । साथ ही शंकराचार्य जी को वस्तुस्थिति से अवगत कराया गया । उन्होंने बताया कि विभिन्न दलों के नेताओं के साथ शंकराचार्य जी ने अखिल भारतीय इमाम संगठन के अध्यक्ष मौलाना जमील इलियासी , इस्लामिक कौंसिल आफ इंडिया के अध्यक्ष कारी मुहम्मद मियां मजहरी , सिया मौलाना सैयद कल्वे रुशेद , हेलाल कमेटी फैजाबाद के पदाधिकारी सहित देवबंद के खालिद अंसारी , ऑल इंडिया सिया कांफ्रेंस के सैयद जमीर सुल्तान सहित दूसरे मौलानाओं से भी विचार - विमर्श किया । अयोध्या विवाद के हल के लिए नए सिरे से ऑल इंडिया मुस्लिम पर्सनल लॉ बोर्ड से बातचीत की रणनीति भी है । इसके लिए प्रस्ताव पर चर्चा शुरू होने वाली है । यह समाधान प्रस्ताव ३० सितंबर २००४ तक तैयार हो जाने की उम्मीद है । इसकी पहली बैठक जून के तीसरे सप्ताह में अयोध्या में आयोजित होगी । इसकी पुष्टि समिति के संयोजक श्री रिजवी भी करते हैं । श्री रिजवी बताते हैं कि समाधान प्रस्ताव सभी संबंधित पक्षों से विचार - विमर्श किया जाएगा तथा अंतिम तौर पर शंकराचार्य जी महाराज और ऑल इंडिया मुस्लिम पर्सनल लॉ बोर्ड के अध्यक्ष मौलाना नदवी साहब ही समाधान प्रस्ताव पर निर्णय करेंगे । वह बताते हैं कि समिति शंकराचार्य जी के प्रति उत्तरदायी होगी । यह भारत सरकार अथवा अन्य शासकीय स्तर पर तभी संपर्क करेगी , जब शंकराचार्य जी की तरफ से उनके प्रमुख सचिव लिखित तौर पर सूचित करेंगे । श्री रिजवी ने बताया कि अक्तूबर २००४ में दिल्ली के विज्ञान भवन में एक समाधान सम्मेलन आयोजित किया जाएगा । इसकी अध्यक्षता शंकराचार्य जी करेंगे । सम्मेलन में अयोध्या प्रकरण से जुड़े सभी पक्षों को आमंत्रित किया जाएगा । समाधान प्रस्ताव को सम्मेलन में पारित करवाकर उसे प्रधानमंत्री सरदार मनमोहन सिंह को इस आशय से सौंपा जाएगा कि भारत सरकार उच्चतम न्यायालय में याचिका पर समाधान प्रक्रिया सुनिश्चित कर सके । उन्होंने साफ किया कि इस विषयक की जानकारी के लिए शंकराचार्य जी के प्रमुख सचिव श्री सुंदर व समन्वय समिति के सदस्यगण ही अधिकृत प्रवक्ता हैं ।"
string=''
for i in l:
	# print i
	string+=i
fi.close()

# print string[575:587]
# print string[548:578]
# print string[581:658]
# print data[655:670]
# print data[550:582]
# print data[580:654]
# print string[579:]
fo1=open((os.path.join('../my_ann/Section_11', 'fullnews_id_2578406_date_7_7_2004.utf8.cml.V.tkn.cml_updated.mo.pos.chnk.prun.posn')),'r')
fo=open((os.path.join('../my_ann/Section_11', 'test.txt')),'r')
m=fo.readlines()
for line in m:
	line=line[:-1]
	line=line.split('|')
	print line[1],line[14],line[20]
	# print line
	indexes=[]
	for i in [line[1],line[14],line[20]]:
		indexes.append(i.split(".."))
		print indexes,"indexes"
	if(indexes):		#Explicit
		print indexes,string[int(indexes[0][0]):int(indexes[0][1])]
	else:				#Implicit
		print "imp"""",indexes,line
		dm=['i',line[7]]
		print dm"""
	print "---------------------"
fo.close()

f=open('rules','r')
l=f.readlines()
string=''
for i in l:
	string+=i
f.close()
trees=string.split('|||')
trees=trees[:-1]
for tree in trees:
	tree=tree.split('<<')
	# print tree,"dfsd"
	print rule1(tree[0])